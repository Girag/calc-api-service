# calc-api-service – сервис, предоставляющий API для подсчёта арифметических выражений

## Важно

Привет! Если ты ревьюишь этот проект, то заранее благодарю тебя за потраченное время и очень прошу не спешить с оценкой. Если вдруг заметишь баги и недоработки, да и если просто возникнут какие-либо вопросы по проекту – пожалуйста, напиши мне в [Telegram](https://t.me/Girag). Я всегда на связи и быстро отреагирую на любую обратную связь. Спасибо!

## Описание

В этом репозитории содержится исходный код веб-сервиса на языке Go, который реализует простой API с единственным эндпоинтом. На него можно отправить POST-запрос с арифметическим выражением в определённом формате и получить в ответ результат его вычисления.

## Использование

### Общая информация

Сервис имеет единственный endpoint `/api/v1/calculate`, на который принимаются только POST-запросы с телом в виде JSON следующего содержимого:

```json
{
  "expression": "2+2"
}
```

где вместо "2+2" может быть любое корректное арифметическое выражение, результат вычисления которого требуется получить.

В ответ на корректный запрос приходит ответ в формате JSON следующего содержания:

```json
{
  "result": 4
}
```

Если же запрос был некорректен, то в ответ будет получен подобный JSON с соответствующим кодом состояния ответа HTTP:

```json
{
  "error": "bad request"
}
```

Все возможные сообщения об ошибках и соответствующие коды ответов будут рассмотрены далее.

### Предварительные шаги

Для корректной работы с проектом необходимо убедиться, что в системе установлены git, curl и Go.

### Запуск

Все последующие действия будут производиться в командной строке терминала. Чтобы запустить веб-сервис нужно склонировать этот репозиторий, перейти в директорию `calc-api-service` и выполнить команду запуска:

```bash
git clone https://github.com/Girag/calc-api-service.git && cd calc-api-service && go run cmd/main.go
```

По умолчанию сервис запускается на порте 8080. Если есть необходимость в смене порта, то в проекте предусмотрена возможность запуска на другом порте через задание переменной окружения `CALC_API_PORT` с нужным номером порта:

```bash
export CALC_API_PORT=3000 && go run cmd/main.go
```

где вместо 3000 может быть подходящий номер порта. Удалить заданную переменную окружения можно следующей командой:

```bash
unset CALC_API_PORT
```

Все последующие примеры использования будут приведены с учётом порта по умолчанию. Если проект будет запущен на другом порте, то перед использованием примеров следует не забыть скорректировать в них порт на выбранный.

Чтобы прервать работу сервиса, достаточно нажать сочетание клавиш `Ctrl` + `C` в терминале, из которого он был запущен.

## Примеры использования

Для отправки запросов к API-сервису будем использовать утилиту `curl`.

### Корректные запросы

Например, очень хочется узнать, сколько же будет 2+2. Для это выполняем следующую команду:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "2+2"}'
```

В результате получаем ответ с 200 кодом (успешно) и значением 4:

```json
{"result":4}%
```

Это корректный результат, пусть и не выглядящий так красиво как в информации выше. API возвращает сырой JSON и чтобы результат выглядел красиво, можно воспользоваться различными JSON-форматтерами, например консольным `jq`. Но это не так важно в данном случае и не является главной темой.

Если нужно вычислить значение другого выражения (например, 5\*(12+7)-8), то берём запрос выше и просто меняем 2+2 на это выражение:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "5*(12+7)-8"}'
```

Главное сформировать корректный JSON в теле запроса указанным образом и результатом также будет корректный ответ:

```json
{"result":87}%
```

### Некорректные запросы

Если к API-сервису будет сформирован неправильный запрос (например, будет нарушена структура валидного JSON-запроса вида `{"expression": "..."}`, где ... – корректное выражение к вычислению), то сервис сообщит об ошибке поясняющим сообщением и кодом HTTP-ответа.

#### Возможные ошибки

| Ошибка                      | Код ответа | Описание                        | Причина                                                  | Пример тела ошибочного запроса |
| --------------------------- | ---------- | ------------------------------- | -------------------------------------------------------- | ------------------------------ |
| invalid expression          | 422        | некорректное выражение          | выражение составлено некорректно                         | `{"expression": "--5"}`        |
| invalid char in expression  | 422        | некорректный символ в выражении | выражение содержит в себе некорретные символы            | `{"expression": "10-1f0"}`     |
| division by zero            | 422        | деление на ноль                 | выражение содержит в себе деление на ноль                | `{"expression": "42/0"}`       |
| opening parenthesis missing | 422        | пропущена открывающая скобка    | в выражении где-то отсутствует открывающая скобка        | `{"expression": "2*33-4)"}`    |
| closing parenthesis missing | 422        | пропущена закрывающая скобка    | в выражении где-то отсутствует закрывающая скобка        | `{"expression": "2*(33-4"}`    |
| bad request                 | 400        | неправильный запрос             | запрос составлен некорректно                             | `{"2+2": "expression"}`        |
| page not found              | 404        | страница не найдена             | запрос осуществляется не на endpoint `/api/v1/calculate` |                                |
| method not allowed          | 405        | недопустимый метод              | запрос осуществляется методтом отличным от POST          |                                |
| internal server error       | 500        | внутренняя ошибка сервера       | произошла внутренняя ошибка сервера                      |                                |
| unknown error               | 500        | неизвестная ошибка              | произошла незвестная ошибка                              |                                |

### invalid expression (422)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "--5"}'
```

Ответ:

```json
{"error":"invalid expression"}%
```

### invalid char in expression (422)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "10-1f0"}'
```

Ответ:

```json
{"error":"invalid char in expression"}%
```

### division by zero (422)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "42/0"}'
```

```json
{"error":"division by zero"}%
```

### opening parenthesis missing (422)

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "2*33-4)"}'
```

Ответ:

```json
{"error":"opening parenthesis missing"}%
```

### closing parenthesis missing (422)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "2*(33-4"}'
```

Ответ:

```json
{"error":"closing parenthesis missing"}%
```

### bad request (400)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"2+2": "expression"}'
```

Ответ:

```json
{"error":"bad request"}%
```

### page not found (404)

Запрос:

```bash
curl -s -X POST http://localhost:8080/api/v1/calc -H 'Content-Type: application/json' -d '{"expression": "2+2"}'
```

Ответ:

```json
{"error":"page not found"}%
```

### method not allowed (405)

Запрос:

```bash
curl -s -X PUT http://localhost:8080/api/v1/calculate -H 'Content-Type: application/json' -d '{"expression": "2+2"}'
```

Ответ:

```json
{"error":"method not allowed"}%
```
